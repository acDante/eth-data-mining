Each mapper receives an array containing 10000 arrays corresponding to input training images and constructs a representative coreset. We initially find a rough approximation (bicriteria approximation) of the optimal clustering (for 200 clusters) using D^2-sampling: the first cluster center is sampled uniformly at random and additional points are then iteratively sampled with probability proportional to the minimum squared distance to the already sampled cluster centers. This approximation is then used to compute an importance sampling distribution, which in turn we use to sample 4000 points with their corresponding weights to construct the coreset. The mapper emits the coreset as the value, using 0 as the key since we want all of the coresets to be processed by the same reducer.
The reducer receives one key value pair, where the value is a flattened list of all the emitted coresets, effectively the union of the coresets, and performs multiple restarts of the k-means algorithm. We initialize the 200 center points by sampling from the coreset with uniform probability. We then perform 15 iterations of the k-means algorithm for 5 restarts. Afterwords we compute the normalized quantization error on the coreset for the results of each restart and emit the results with the smallest error.
